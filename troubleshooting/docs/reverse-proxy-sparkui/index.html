
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../connect-spark-ui/">
      
      
        <link rel="next" href="../self-hosted-shs/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Connect to Spark UI via Reverse Proxy - EMR Containers Best Practices Guides</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connect-to-sparkui-without-port-fowarding" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="EMR Containers Best Practices Guides" class="md-header__button md-logo" aria-label="EMR Containers Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EMR Containers Best Practices Guides
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Connect to Spark UI via Reverse Proxy
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-emr-containers-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-emr-containers-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../security/docs/spark/encryption/" class="md-tabs__link">
          
  
  Security

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../submit-applications/docs/spark/pyspark/" class="md-tabs__link">
          
  
  Submit applications

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../storage/docs/spark/ebs/" class="md-tabs__link">
          
  
  Storage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../metastore-integrations/docs/hive-metastore/" class="md-tabs__link">
          
  
  Metastore Integration

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../where-to-look-for-spark-logs/" class="md-tabs__link">
          
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../node-placement/docs/eks-node-placement/" class="md-tabs__link">
          
  
  Node Placement

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../performance/docs/dra/" class="md-tabs__link">
          
  
  Performance

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cost-optimization/docs/cost-optimization/" class="md-tabs__link">
          
  
  Cost Optimization

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="EMR Containers Best Practices Guides" class="md-nav__button md-logo" aria-label="EMR Containers Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EMR Containers Best Practices Guides
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-emr-containers-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-emr-containers-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../outposts/emr-containers-on-outposts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMR on EKS(AWS Outposts)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/spark/encryption/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encryption
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/spark/data-encryption/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Encryption
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/spark/network-security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/spark/secrets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secrets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Submit applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Submit applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../submit-applications/docs/spark/pyspark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pyspark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../submit-applications/docs/spark/multi-arch-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build Multi-arch Docker Image
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Storage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/docs/spark/ebs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EBS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/docs/spark/fsx-lustre/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FSx for Lustre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../storage/docs/spark/instance-store/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instance Store
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metastore Integration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Metastore Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../metastore-integrations/docs/hive-metastore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive Metastore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../metastore-integrations/docs/aws-glue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Glue
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../where-to-look-for-spark-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark Log Location in S3 and CloudWatch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../change-log-level/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Log Level
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connect-spark-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connect to Spark UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Connect to Spark UI via Reverse Proxy
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Connect to Spark UI via Reverse Proxy
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-sparkui-reserve-proxy-and-an-ingress-in-a-default-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy SparkUI reserve proxy and an Ingress in a default namespace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grant-permissions-to-driver-pods-service-account" class="md-nav__link">
    <span class="md-ellipsis">
      Grant permissions to Driver pod's Service Account
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-via-spark-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs via Spark Operator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-via-job-run-api" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs via Job Run API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-by-spark-submit" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs by Spark Submit:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploymentyaml" class="md-nav__link">
    <span class="md-ellipsis">
      deployment.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-operator-example-01yaml" class="md-nav__link">
    <span class="md-ellipsis">
      spark-operator-example-01.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-operator-example-02yaml" class="md-nav__link">
    <span class="md-ellipsis">
      spark-operator-example-02.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#driver-pod-templateyaml" class="md-nav__link">
    <span class="md-ellipsis">
      driver-pod-template.yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-hosted-shs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self Hosted SHS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac-permissions-errors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC Permissions error
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eks-cluster-auto-scaler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Cluster AutoScaler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../karpenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Karpenter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Node Placement
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Node Placement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../node-placement/docs/eks-node-placement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Node placement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../node-placement/docs/fargate-node-placement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Fargate Node placement
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Performance
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../performance/docs/dra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Resource Allocation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../performance/docs/binpack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BinPacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../best-practices-and-recommendations/eks-best-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Best Practices
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cost Optimization
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Cost Optimization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost-optimization/docs/cost-optimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cost Optimization using EC2 Spot Instances
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost-optimization/docs/node-decommission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Decommission
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-sparkui-reserve-proxy-and-an-ingress-in-a-default-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy SparkUI reserve proxy and an Ingress in a default namespace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grant-permissions-to-driver-pods-service-account" class="md-nav__link">
    <span class="md-ellipsis">
      Grant permissions to Driver pod's Service Account
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-via-spark-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs via Spark Operator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-via-job-run-api" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs via Job Run API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-emr-on-eks-jobs-by-spark-submit" class="md-nav__link">
    <span class="md-ellipsis">
      Launch EMR on EKS jobs by Spark Submit:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploymentyaml" class="md-nav__link">
    <span class="md-ellipsis">
      deployment.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-operator-example-01yaml" class="md-nav__link">
    <span class="md-ellipsis">
      spark-operator-example-01.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-operator-example-02yaml" class="md-nav__link">
    <span class="md-ellipsis">
      spark-operator-example-02.yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#driver-pod-templateyaml" class="md-nav__link">
    <span class="md-ellipsis">
      driver-pod-template.yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="connect-to-sparkui-without-port-fowarding"><strong>Connect to SparkUI without Port Fowarding</strong><a class="headerlink" href="#connect-to-sparkui-without-port-fowarding" title="Permanent link">&para;</a></h1>
<p>This is an example of connecting to SparkUI running on Spark's driver pod via a reserve proxy solution, without an access to the kubectl tool or AWS console. </p>
<div style="border: 1px solid red; padding: 10px; background-color: #f8d7da;">
  <strong>NOTE:</strong> We don't maintain the reverse proxy solution's docker image. 
</div>

<p>A reverse proxy sits between a single Ingress ALB and multiple driver pods. The ALB forwards all incoming traffic to the reverse proxy, which then directs requests to the appropriate driver pods based on the URI path in each request. This routing occurs via Kubernetes service objects, with one service object required for each driver pod. These service objects should be named using the format <code>&lt;last-segment-of-URI-path&gt;-ui-svc</code>. To complete this setup, the following properties must be configured in the Spark configuration:</p>
<table>
<thead>
<tr>
<th>Configuratin</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>spark.ui.proxyBase</td>
<td>/sparkui/my-spark-app</td>
<td>The URI path on which to access the particular job's spark UI. This is divided into two parts, first is base URI (i.e. /sparkui) and second is the name used to redirect the traffic to corresponding kubernetes service. e.g. if URI path is "/sparkui/my-spark-app" then reverse proxy redirects the traffic to Kubernetes service named "my-spark-app-ui-svc".  Note: Don't change the /sparkui/ base URI as its a default base URI used by Spark revserve proxy</td>
</tr>
<tr>
<td>spark.ui.proxyRedirectUri</td>
<td>/</td>
<td>Redirect URI. Keep it "/".</td>
</tr>
</tbody>
</table>
<p>The URL to access Spark UI is,<br />
<code>http://YOUR_INGRESS_ADDRESS:PORT/&lt;spark.ui.proxyBase&gt;</code><br />
e.g. http://k8s-default-sparkui-2d325c0434-124141735.us-west-2.elb.amazonaws.com:80/sparkui/my-spark-app</p>
<p>Where,<br />
<em> YOUR_INGRESS_ADDRESS:PORT</em> :- Ingress ALB's DNS name and port. </p>
<p>We demostrate how to set up Ingress and Reverse Proxy. Then launch the jobs via three EMR on EKS deployment methods: Spark Operator, JobRun API, and spark-submit. The spark operator creates the Kubernetes service object with target as driver pod for each job. However, JobRun API and spark-submit do not create Kubernetes service object so we use driver pod's "postStart" lifecycle hook to create the service object in driver pod's template.</p>
<h2 id="deploy-sparkui-reserve-proxy-and-an-ingress-in-a-default-namespace">Deploy SparkUI reserve proxy and an Ingress in a default namespace<a class="headerlink" href="#deploy-sparkui-reserve-proxy-and-an-ingress-in-a-default-namespace" title="Permanent link">&para;</a></h2>
<p>Create a SparkUI reverse proxy and an Ingress (ALB) in a default namespace, which is a different namespace from your EMR on EKS virtual cluster environment. It can be configured to the EMR's namespace if neccessary.</p>
<p>The <a href="#deploymentyaml">sample yaml file</a> is in the Appendix section. Make sure the EMR on EKS's namespace at the line #25 in <code>deployment.yaml</code> is updated if needed:</p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml
</code></pre></div>

<div style="border: 1px solid red; padding: 10px; background-color: #f8d7da;">
  <strong>NOTE:</strong> The example file is not production ready. This solution doesn't have authenticate on spark UI in place. Also, the listen port 80 is not recommended. Make sure to strengthen your Application Load Balance's security posture before deploying it to your production environment.
</div>

<p>EKS Admin can provide the ALB endpoint address to users via the command: </p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>ingress

NAME<span class="w">       </span>CLASS<span class="w">               </span>HOSTS<span class="w">   </span>ADDRESS<span class="w">                                                                </span>PORTS<span class="w">   </span>AGE
spark-ui<span class="w">   </span>alb-ingress-class<span class="w">   </span>*<span class="w">       </span>k8s-default-sparkui-627e515973-123456789.us-west-2.elb.amazonaws.com<span class="w">   </span><span class="m">80</span><span class="w">      </span>14d
</code></pre></div>

<h2 id="grant-permissions-to-driver-pods-service-account">Grant permissions to Driver pod's Service Account<a class="headerlink" href="#grant-permissions-to-driver-pods-service-account" title="Permanent link">&para;</a></h2>
<div style="border: 1px solid red; padding: 10px; background-color: #f8d7da;">
  <strong>NOTE:</strong> This step is required for JobRun API or spark-submit. It is NOT required for spark operator.
</div>
<p>If you are going to use JobRun API or spark-submit to launch the jobs then grant permissions to Kubernetes role bound to Driver pod's Service Account to be able to manage Kubernetes Service Object.</p>
<p>The client &amp; driver roles and corresponding service accounts are can be queried via command:</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">EMR_CONTAINERS_NAMESPACE</span><span class="o">=</span><span class="n">emr</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">eks</span>

<span class="n">kubectl</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">$</span><span class="n">EMR_CONTAINERS_NAMESPACE</span><span class="w">                                                                                                                     </span>
<span class="n">NAME</span><span class="w">                               </span><span class="n">CREATED</span><span class="w"> </span><span class="n">AT</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w">                     </span><span class="mi">2024</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span><span class="n">T08</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">15</span><span class="n">Z</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">client</span><span class="w">   </span><span class="mi">2024</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span><span class="n">T09</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">37</span><span class="n">Z</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">driver</span><span class="w">   </span><span class="mi">2024</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span><span class="n">T09</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">37</span><span class="n">Z</span>

<span class="n">kubectl</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">serviceaccount</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">$</span><span class="n">EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>
<span class="n">NAME</span><span class="w">                                                                           </span><span class="n">SECRETS</span><span class="w">   </span><span class="n">AGE</span>
<span class="n">default</span><span class="w">                                                                        </span><span class="mi">0</span><span class="w">         </span><span class="mi">62</span><span class="n">m</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">sa</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="mi">1234567890</span><span class="o">-</span><span class="n">abcdefgh123456ijklmno7890prrst</span><span class="w">       </span><span class="mi">0</span><span class="w">         </span><span class="mi">28</span><span class="n">s</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">sa</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="mi">1234567890</span><span class="o">-</span><span class="n">abcdefgh123456ijklmno7890prrst</span><span class="w">       </span><span class="mi">0</span><span class="w">         </span><span class="mi">28</span><span class="n">s</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">sa</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">executor</span><span class="o">-</span><span class="mi">1234567890</span><span class="o">-</span><span class="n">abcdefgh123456ijklmno7890prrst</span><span class="w">     </span><span class="mi">0</span><span class="w">         </span><span class="mi">28</span><span class="n">s</span>

<span class="n">kubectl</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">rolebindings</span><span class="o">.</span><span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">$</span><span class="n">EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>
<span class="n">NAME</span><span class="w">                                                                       </span><span class="n">ROLE</span><span class="w">                                    </span><span class="n">AGE</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w">                                                             </span><span class="n">Role</span><span class="o">/</span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w">                     </span><span class="mi">62</span><span class="n">m</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">rb</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="mi">1234567890</span><span class="o">-</span><span class="n">abcdefgh123456ijklmno7890prrst</span><span class="w">   </span><span class="n">Role</span><span class="o">/</span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">client</span><span class="w">   </span><span class="mi">46</span><span class="n">s</span>
<span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">rb</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">driver</span><span class="o">-</span><span class="mi">1234567890</span><span class="o">-</span><span class="n">abcdefgh123456ijklmno7890prrst</span><span class="w">   </span><span class="n">Role</span><span class="o">/</span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="o">-</span><span class="n">role</span><span class="o">-</span><span class="n">spark</span><span class="o">-</span><span class="n">driver</span><span class="w">   </span><span class="mi">46</span><span class="n">s</span>
</code></pre></div>

<p>EKS Admin can grant the list, create, update, delete and patch for Kubernetes Service Object to spark driver role via the command:  </p>
<p>Ensure to set <code>EMR_CONTAINERS_ROLE_SPARK_DRIVER</code> to Kubernetes role binded to driver pod's service account and <code>EMR_CONTAINERS_NAMESPACE</code> to Kubernetes namespace in which EMR on EKS is running.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_ROLE_SPARK_DRIVER</span><span class="o">=</span>emr-containers-role-spark-driver
<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_NAMESPACE</span><span class="o">=</span>emr-on-eks
kubectl<span class="w"> </span>patch<span class="w"> </span>role<span class="w"> </span><span class="nv">$EMR_CONTAINERS_ROLE_SPARK_DRIVER</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--type<span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="w"> </span>-p<span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/rules/-&quot;, &quot;value&quot;: {&quot;apiGroups&quot;: [&quot;&quot;], &quot;resources&quot;: [&quot;services&quot;], &quot;verbs&quot;: [&quot;list&quot;, &quot;create&quot;, &quot;update&quot;, &quot;delete&quot;, &quot;patch&quot;]}}]&#39;</span>
</code></pre></div>

<p>EKS Admin can varify the access to Driver Pod's Service Account via the command:  </p>
<p>Ensure to set <code>EMR_CONTAINERS_SA_SPARK_DRIVER</code> to service account binded to above role. The output of each command should be "yes"</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_SA_SPARK_DRIVER</span><span class="o">=</span>emr-containers-sa-spark-driver-1234567890-abcdefgh123456ijklmno7890prrst
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w">   </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:<span class="nv">$EMR_CONTAINERS_NAMESPACE</span>:<span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:<span class="nv">$EMR_CONTAINERS_NAMESPACE</span>:<span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>update<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:<span class="nv">$EMR_CONTAINERS_NAMESPACE</span>:<span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>delete<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:<span class="nv">$EMR_CONTAINERS_NAMESPACE</span>:<span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>patch<span class="w">  </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:<span class="nv">$EMR_CONTAINERS_NAMESPACE</span>:<span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span>
</code></pre></div>

<h2 id="launch-emr-on-eks-jobs-via-spark-operator">Launch EMR on EKS jobs via Spark Operator<a class="headerlink" href="#launch-emr-on-eks-jobs-via-spark-operator" title="Permanent link">&para;</a></h2>
<p>1.Submit two test jobs using EMR on EKS's Spark Operator. The sample job scripts <a href="#spark-operator-example-01yaml">spark-operator-example-01.yaml</a> and <a href="#spark-operator-example-02yaml">spark-operator-example-02.yaml</a> can be found in the Appendix section. </p>
<ul>
<li>The <code>spec.driver.Serviceaccount</code> attribute should be updated based on your own <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html">IAM Role for Service Account (IRSA)</a> setup in EMR on EKS.</li>
<li>The <code>namespace</code> attribute should be updated to namespace where EMR on EKS is running</li>
<li>Remember to specify the Spark configuration at line #16 <code>spark.ui.proxyBase: /sparkui/YOUR_SPARK_APP_NAME</code>, eg. <code>spark.ui.proxyBase: /sparkui/spark-example-01</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>spark-operator-example-01.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>spark-operator-example-02.yaml
</code></pre></div>

<p>2.Go to a web browser, then access their Spark Web UI while jobs are still running.</p>
<p>The Web UI address is in the format of <code>http://YOUR_INGRESS_ADDRESS:PORT/sparkui/YOUR_SPARK_APP_NAME</code>. For example:</p>
<div class="codehilite"><pre><span></span><code>http://k8s-default-sparkui-2d325c0434-124141735.us-west-2.elb.amazonaws.com:80/sparkui/spark-example-01
http://k8s-default-sparkui-2d325c0434-124141735.us-west-2.elb.amazonaws.com:80/sparkui/spark-example-02
</code></pre></div>

<h2 id="launch-emr-on-eks-jobs-via-job-run-api">Launch EMR on EKS jobs via Job Run API<a class="headerlink" href="#launch-emr-on-eks-jobs-via-job-run-api" title="Permanent link">&para;</a></h2>
<p>1.Upload the driver pod template to S3 bucket. It is assumed that template is copied under prefix (folder) <code>/templates</code> inside bucket.</p>
<div class="codehilite"><pre><span></span><code>aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span>driver-pod-template.yaml<span class="w"> </span>YOUR_S3_BUCKET/templates
</code></pre></div>

<p>2.Ensure that Job execution role has access to above S3 bucket.</p>
<p>3.Set the values for <code>YOUR_APP_NAME</code>, <code>YOUR_S3_BUCKET</code>, <code>YOUR_EMR_VIRTUAL_CLUSTER_NAME</code>, <code>YOUR_EMR_JOB_EXECUTION_ROLE</code> and run the sample job submission script below:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">YOUR_APP_NAME</span><span class="o">=</span>start-job-run-pi
<span class="nb">export</span><span class="w"> </span><span class="nv">S3BUCKET</span><span class="o">=</span>YOUR_S3_BUCKET

<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_VIRTUAL_CLUSTER_NAME</span><span class="o">=</span>YOUR_EMR_VIRTUAL_CLUSTER_NAME
<span class="nb">export</span><span class="w"> </span><span class="nv">VIRTUAL_CLUSTER_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>emr-containers<span class="w"> </span>list-virtual-clusters<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;virtualClusters[?name == &#39;</span><span class="nv">$EMR_VIRTUAL_CLUSTER_NAME</span><span class="s2">&#39; &amp;&amp; state == &#39;RUNNING&#39;].id&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">ACCOUNTID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w"> </span>--query<span class="w"> </span>Account<span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_ROLE_ARN</span><span class="o">=</span>arn:aws:iam::<span class="nv">$ACCOUNTID</span>:role/YOUR_EMR_JOB_EXECUTION_ROLE

aws<span class="w"> </span>emr-containers<span class="w"> </span>start-job-run<span class="w"> </span><span class="se">\</span>
--virtual-cluster-id<span class="w"> </span><span class="nv">$VIRTUAL_CLUSTER_ID</span><span class="w"> </span><span class="se">\</span>
--name<span class="w"> </span><span class="nv">$YOUR_APP_NAME</span><span class="w"> </span><span class="se">\</span>
--execution-role-arn<span class="w"> </span><span class="nv">$EMR_ROLE_ARN</span><span class="w"> </span><span class="se">\</span>
--release-label<span class="w"> </span>emr-7.1.0-latest<span class="w"> </span><span class="se">\</span>
--job-driver<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">&quot;sparkSubmitJobDriver&quot;: {</span>
<span class="s1">    &quot;entryPoint&quot;: &quot;local:///usr/lib/spark/examples/jars/spark-examples.jar&quot;, </span>
<span class="s1">    &quot;entryPointArguments&quot;: [&quot;100000&quot;],</span>
<span class="s1">    &quot;sparkSubmitParameters&quot;: &quot;--class org.apache.spark.examples.SparkPi --conf spark.executor.instances=1 --conf spark.kubernetes.driver.podTemplateFile=s3://&#39;</span><span class="si">${</span><span class="nv">S3BUCKET</span><span class="si">}</span><span class="s1">&#39;/templates/driver-pod-template.yaml&quot; }}&#39;</span><span class="w"> </span><span class="se">\</span>
--configuration-overrides<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">&quot;applicationConfiguration&quot;: [</span>
<span class="s1">    {</span>
<span class="s1">    &quot;classification&quot;: &quot;spark-defaults&quot;, </span>
<span class="s1">    &quot;properties&quot;: {</span>
<span class="s1">        &quot;spark.ui.proxyBase&quot;: &quot;/sparkui/&#39;</span><span class="si">${</span><span class="nv">YOUR_APP_NAME</span><span class="si">}</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;spark.ui.proxyRedirectUri&quot;: &quot;/&quot;</span>
<span class="s1">    }}]}&#39;</span>
</code></pre></div>

<p>2.Go to a web browser, then access their Spark Web UI while jobs are still running.</p>
<div class="codehilite"><pre><span></span><code>http://&lt;YOUR_INGRESS_ADDRESS&gt;/sparkui/&lt;YOUR_APP_NAME&gt;
</code></pre></div>

<p>Admin can get the ingress address by the CLI:</p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>ingress
</code></pre></div>

<p>The SparkUI service is created on postStart event of driver container and looks like this:</p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span>

NAME<span class="w">                  </span>TYPE<span class="w">      </span>CLUSTER-IP<span class="w">  </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">  </span>AGE
YOUR_APP_NAME-ui-svc<span class="w"> </span>ClusterIP<span class="w"> </span><span class="m">10</span>.100.233.186<span class="w">  </span>&lt;none&gt;<span class="w">      </span><span class="m">4040</span>/TCP<span class="w">   </span>9s
</code></pre></div>

<h2 id="launch-emr-on-eks-jobs-by-spark-submit">Launch EMR on EKS jobs by Spark Submit:<a class="headerlink" href="#launch-emr-on-eks-jobs-by-spark-submit" title="Permanent link">&para;</a></h2>
<p>1.Create an EMR on EKS pod with a service account that has the <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html">IRSA</a> associated and have permission to access the S3 bucket which has pod template.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_NAMESPACE</span><span class="o">=</span>emr-on-eks
<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_SA_SPARK_CLIENT</span><span class="o">=</span>emr-containers-sa-spark-client-1234567890-abcdefgh123456ijklmno7890prrst

kubectl<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>emrekspod<span class="w"> </span><span class="se">\</span>
--image<span class="o">=</span>public.ecr.aws/emr-on-eks/spark/emr-7.1.0:latest<span class="w"> </span><span class="se">\</span>
--overrides<span class="o">=</span><span class="s1">&#39;{ &quot;spec&quot;: {&quot;serviceAccount&quot;: &quot;&#39;</span><span class="si">${</span><span class="nv">EMR_CONTAINERS_SA_SPARK_CLIENT</span><span class="si">}</span><span class="s1">&#39;&quot;}}&#39;</span><span class="w"> </span><span class="se">\</span>
--command<span class="w"> </span>-n<span class="w"> </span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span>/bin/bash
</code></pre></div>

<p>2.After login into the "emrekspod" pod, submit the job:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">YOUR_APP_NAME</span><span class="o">=</span>spark-submit-pi
<span class="nb">export</span><span class="w"> </span><span class="nv">S3BUCKET</span><span class="o">=</span>YOUR_S3_BUCKET
<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_NAMESPACE</span><span class="o">=</span>emr-on-eks
<span class="nb">export</span><span class="w"> </span><span class="nv">EMR_CONTAINERS_SA_SPARK_DRIVER</span><span class="o">=</span>emr-containers-sa-spark-driver-1234567890-abcdefgh123456ijklmno7890prrst

spark-submit<span class="w"> </span><span class="se">\</span>
--master<span class="w"> </span>k8s://<span class="nv">$KUBERNETES_SERVICE_HOST</span>:443<span class="w"> </span><span class="se">\</span>
--deploy-mode<span class="w"> </span>cluster<span class="w"> </span><span class="se">\</span>
--name<span class="w"> </span><span class="nv">$YOUR_APP_NAME</span><span class="w"> </span><span class="se">\</span>
--class<span class="w"> </span>org.apache.spark.examples.SparkPi<span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.kubernetes.driver.podTemplateFile<span class="o">=</span>s3://<span class="nv">$S3BUCKET</span>/templates/driver-pod-template.yaml<span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.kubernetes.driver.podTemplateContainerName<span class="o">=</span>spark-kubernetes-driver<span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.ui.proxyBase<span class="o">=</span>/sparkui/<span class="nv">$YOUR_APP_NAME</span><span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.ui.proxyRedirectUri<span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.kubernetes.container.image<span class="o">=</span>public.ecr.aws/emr-on-eks/spark/emr-7.1.0:latest<span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.kubernetes.authenticate.driver.serviceAccountName<span class="o">=</span><span class="nv">$EMR_CONTAINERS_SA_SPARK_DRIVER</span><span class="w"> </span><span class="se">\</span>
--conf<span class="w"> </span>spark.kubernetes.namespace<span class="o">=</span><span class="nv">$EMR_CONTAINERS_NAMESPACE</span><span class="w"> </span><span class="se">\</span>
local:///usr/lib/spark/examples/jars/spark-examples.jar<span class="w"> </span><span class="m">100000</span>
</code></pre></div>

<p>3.Go to a web browser, then access their Spark Web UI while jobs are still running.</p>
<div class="codehilite"><pre><span></span><code>http://&lt;YOUR_INGRESS_ADDRESS&gt;/sparkui/&lt;YOUR_APP_NAME&gt;
</code></pre></div>

<p>Admin can get the ingress address by the CLI:</p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>ingress
</code></pre></div>

<p>The SparkUI service looks like this:</p>
<div class="codehilite"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>emr

NAME<span class="w">                  </span>TYPE<span class="w">      </span>CLUSTER-IP<span class="w">  </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">  </span>AGE
job-run-api-ui-svc<span class="w"> </span>ClusterIP<span class="w"> </span><span class="m">10</span>.100.233.186<span class="w">  </span>&lt;none&gt;<span class="w">      </span><span class="m">4040</span>/TCP<span class="w">   </span>9s
</code></pre></div>

<h2 id="appendix">Appendix<a class="headerlink" href="#appendix" title="Permanent link">&para;</a></h2>
<h3 id="deploymentyaml">deployment.yaml<a class="headerlink" href="#deploymentyaml" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/datapunchorg/spark-ui-reverse-proxy:main-1652762636</span>
<span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;/usr/bin/spark-ui-reverse-proxy&#39;</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="c1"># EMR on EKS&#39;s namespace</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-namespace=emr-on-eks</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>

<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IngressClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alb-ingress-class</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress.k8s.aws/alb</span>

<span class="nn">---</span><span class="w"> </span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># kubernetes.io/ingress.class: alb</span>
<span class="w">    </span><span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
<span class="w">    </span><span class="nt">alb.ingress.kubernetes.io/target-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip</span>
<span class="w">    </span><span class="nt">alb.ingress.kubernetes.io/success-codes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200,301,302</span>
<span class="w">    </span><span class="nt">alb.ingress.kubernetes.io/listen-ports</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[{&quot;HTTP&quot;:</span><span class="nv"> </span><span class="s">80}]&#39;</span>
<span class="w">    </span><span class="nt">alb.ingress.kubernetes.io/manage-backend-security-group-rules</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="c1"># alb.ingress.kubernetes.io/security-groups: {{INBOUND_SG}}</span>
<span class="w">  </span><span class="c1"># labels:</span>
<span class="w">  </span><span class="c1">#   app: spark-ui-reverse-proxy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alb-ingress-class&quot;</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-ui-reverse-proxy</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>

<h3 id="spark-operator-example-01yaml">spark-operator-example-01.yaml<a class="headerlink" href="#spark-operator-example-01yaml" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sparkoperator.k8s.io/v1beta2&quot;</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SparkApplication</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-example-01</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emr-on-eks</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Scala</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public.ecr.aws/emr-on-eks/spark/emr-7.1.0:latest</span>
<span class="w">  </span><span class="nt">mainClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.spark.examples.SparkPi</span>
<span class="w">  </span><span class="nt">mainApplicationFile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local:///usr/lib/spark/examples/jars/spark-examples.jar&quot;</span>
<span class="w">  </span><span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;100000&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">sparkVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.5.0</span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
<span class="w">  </span><span class="nt">sparkConf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spark.ui.proxyBase</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sparkui/spark-example-01</span>
<span class="w">    </span><span class="nt">spark.ui.proxyRedirectUri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">coreLimit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1200m&quot;</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1g&quot;</span>
<span class="w">    </span><span class="nt">serviceAccount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emr-containers-sa-spark</span>
<span class="w">  </span><span class="nt">executor</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2g&quot;</span>
</code></pre></div>

<h3 id="spark-operator-example-02yaml">spark-operator-example-02.yaml<a class="headerlink" href="#spark-operator-example-02yaml" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sparkoperator.k8s.io/v1beta2&quot;</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SparkApplication</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-example-02</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emr-on-eks</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Scala</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public.ecr.aws/emr-on-eks/spark/emr-7.1.0:latest</span>
<span class="w">  </span><span class="nt">mainClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.spark.examples.SparkPi</span>
<span class="w">  </span><span class="nt">mainApplicationFile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local:///usr/lib/spark/examples/jars/spark-examples.jar&quot;</span>
<span class="w">  </span><span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;1000000&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">sparkVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.5.0</span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
<span class="w">  </span><span class="nt">sparkConf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spark.ui.proxyBase</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sparkui/spark-example-02</span>
<span class="w">    </span><span class="nt">spark.ui.proxyRedirectUri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">coreLimit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1200m&quot;</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1g&quot;</span>
<span class="w">    </span><span class="nt">serviceAccount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emr-containers-sa-spark</span>
<span class="w">  </span><span class="nt">executor</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2120m&quot;</span>
</code></pre></div>

<h3 id="driver-pod-templateyaml">driver-pod-template.yaml<a class="headerlink" href="#driver-pod-templateyaml" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-kubernetes-driver</span><span class="w"> </span><span class="c1"># This will be interpreted as driver Spark main container</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">postStart</span><span class="p">:</span>
<span class="w">        </span><span class="nt">exec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no"># Set Variables</span>
<span class="w">              </span><span class="no">export K8S_NAMESPACE=`cat  /run/secrets/kubernetes.io/serviceaccount/namespace`</span>
<span class="w">              </span><span class="no">export SPARK_UI_PROXYBASE=`grep spark.ui.proxyBase ${SPARK_CONF_DIR}/spark.properties | rev |  cut -d/ -f1 | rev`</span>
<span class="w">              </span><span class="no">export SPARK_UI_SERVICE_NAME=${SPARK_UI_PROXYBASE}-ui-svc</span>

<span class="w">              </span><span class="no">cat &gt; /tmp/service.yaml &lt;&lt; EOF</span>
<span class="w">              </span><span class="no">apiVersion: v1</span>
<span class="w">              </span><span class="no">kind: Service</span>
<span class="w">              </span><span class="no">metadata:</span>
<span class="w">                </span><span class="no">name: ${SPARK_UI_SERVICE_NAME}</span>
<span class="w">                </span><span class="no">namespace: $K8S_NAMESPACE</span>
<span class="w">                </span><span class="no">labels:</span>
<span class="w">                  </span><span class="no">spark-app-selector: ${SPARK_APPLICATION_ID}</span>
<span class="w">                  </span><span class="no">spark-role: driver</span>
<span class="w">              </span><span class="no">spec:</span>
<span class="w">                </span><span class="no">ports:</span>
<span class="w">                </span><span class="no">- port: 4040</span>
<span class="w">                  </span><span class="no">targetPort: 4040</span>
<span class="w">                  </span><span class="no">protocol: TCP</span>
<span class="w">                </span><span class="no">selector:</span>
<span class="w">                  </span><span class="no">spark-app-selector: ${SPARK_APPLICATION_ID}</span>
<span class="w">                  </span><span class="no">spark-role: driver</span>
<span class="w">                </span><span class="no">type: ClusterIP</span>
<span class="w">              </span><span class="no">EOF</span>

<span class="w">              </span><span class="no">if [ -n &quot;${SPARK_UI_PROXYBASE:-}&quot; ]; then</span>
<span class="w">                </span><span class="no"># Create or replace the service </span>
<span class="w">                </span><span class="no">curl -X PUT https://${KUBERNETES_SERVICE_HOST}/api/v1/namespaces/${K8S_NAMESPACE}/services/${SPARK_UI_SERVICE_NAME} -H &quot;Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)&quot; -H &quot;Content-Type: application/yaml&quot; --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt --data-binary @/tmp/service.yaml &gt; /tmp/service.out</span>
<span class="w">              </span><span class="no">else</span>
<span class="w">                </span><span class="no">echo spark.ui.proxyBase is NOT set in ${SPARK_CONF_DIR}/spark.properties &gt; /tmp/service.out</span>
<span class="w">              </span><span class="no">fi</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>